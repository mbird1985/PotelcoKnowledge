{% extends "base.html" %}
{% block content %}
<div class="max-w-3xl mx-auto mt-6">
  <div id="chat-output" class="bg-white p-6 rounded-lg shadow-md mb-4 max-h-96 overflow-y-auto space-y-4"></div>
  <form id="chat-form" class="flex items-center gap-2">
    <input type="text" id="chat-input" placeholder="Ask a question..." class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent">
    <button type="submit" class="bg-teal-500 text-white px-4 py-3 rounded-lg hover:bg-teal-600 transition">Send</button>
  </form>
</div>

<script>
document.getElementById('chat-form').addEventListener('submit', function(e) {
  e.preventDefault();
  var query = document.getElementById('chat-input').value.trim();
  if (!query) return;
  fetch('/chat/ask', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({query: query})
  })
  .then(response => {
    if (!response.ok) throw new Error('Server error: ' + response.status);
    return response.json();
  })
  .then(data => {
    var output = document.getElementById('chat-output');
    output.innerHTML += `<div class="p-3 bg-gray-100 rounded-lg animate-fade-in"><strong class="text-teal-700">You:</strong> ${escapeHtml(query)}</div>`;
    output.innerHTML += `<div class="p-3 bg-teal-50 rounded-lg animate-fade-in"><strong class="text-teal-700">Assistant:</strong> ${escapeHtml(data.response)}</div>`;
    document.getElementById('chat-input').value = '';
    output.scrollTop = output.scrollHeight;
  })
  .catch(error => {
    var output = document.getElementById('chat-output');
    output.innerHTML += `<div class="p-3 bg-red-100 text-red-700 rounded-lg"><strong>Error:</strong> ${escapeHtml(error.message)}</div>`;
  });
});

function escapeHtml(unsafe) {
  return unsafe
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}
</script>
<style>
  @keyframes fade-in {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .animate-fade-in {
    animation: fade-in 0.3s ease-out;
  }
</style>
{% endblock %}